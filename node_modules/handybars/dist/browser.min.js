/**
 * 
 * Handybars
 * 
 * Copyright (c) 2020, Jocelyn Badgley
 * 
 * Permission is hereby granted, free of charge, to any person obtaining
 * a copy of this software and associated documentation files (the
 * "Software"), to deal in the Software without restriction, including
 * without limitation the rights to use, copy, modify, merge, publish,
 * distribute, sublicense, and/or sell copies of the Software, and to
 * permit persons to whom the Software is furnished to do so, subject to
 * the following conditions:
 * 
 * The above copyright notice and this permission notice shall be
 * included in all copies or substantial portions of the Software.
 * 
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND,
 * EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
 * MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND
 * NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE
 * LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION
 * OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION
 * WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
 * 
 * Portions of the MIT licensed date-fns library are bundled with this
 * software. https://github.com/date-fns/date-fns#readme
 */

!function(e,n){"object"==typeof exports&&"undefined"!=typeof module?n(exports):"function"==typeof define&&define.amd?define(["exports"],n):n((e=e||self).MiniHandle={})}(this,(function(e){"use strict";function n(e){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function t(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}function r(e,n){for(var t=0;t<n.length;t++){var r=n[t];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function i(e,n,t){return n&&r(e.prototype,n),t&&r(e,t),e}function o(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function u(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,r)}return t}function a(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?u(Object(t),!0).forEach((function(n){o(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):u(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function f(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(n&&n.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),n&&l(e,n)}function c(e){return(c=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function l(e,n){return(l=Object.setPrototypeOf||function(e,n){return e.__proto__=n,e})(e,n)}function s(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}function v(e,n){if(null==e)return{};var t,r,i=function(e,n){if(null==e)return{};var t,r,i={},o=Object.keys(e);for(r=0;r<o.length;r++)t=o[r],n.indexOf(t)>=0||(i[t]=e[t]);return i}(e,n);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)t=o[r],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(i[t]=e[t])}return i}function h(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function p(e,n){return!n||"object"!=typeof n&&"function"!=typeof n?h(e):n}function y(e){return function(){var n,t=c(e);if(s()){var r=c(this).constructor;n=Reflect.construct(t,arguments,r)}else n=t.apply(this,arguments);return p(this,n)}}function d(e,n){return m(e)||function(e,n){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var t=[],r=!0,i=!1,o=void 0;try{for(var u,a=e[Symbol.iterator]();!(r=(u=a.next()).done)&&(t.push(u.value),!n||t.length!==n);r=!0);}catch(e){i=!0,o=e}finally{try{r||null==a.return||a.return()}finally{if(i)throw o}}return t}(e,n)||O(e,n)||k()}function g(e){return m(e)||w(e)||O(e)||k()}function b(e){return function(e){if(Array.isArray(e))return j(e)}(e)||w(e)||O(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function m(e){if(Array.isArray(e))return e}function w(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}function O(e,n){if(e){if("string"==typeof e)return j(e,n);var t=Object.prototype.toString.call(e).slice(8,-1);return"Object"===t&&e.constructor&&(t=e.constructor.name),"Map"===t||"Set"===t?Array.from(t):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?j(e,n):void 0}}function j(e,n){(null==n||n>e.length)&&(n=e.length);for(var t=0,r=new Array(n);t<n;t++)r[t]=e[t];return r}function k(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function E(e){if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(e=O(e))){var n=0,t=function(){};return{s:t,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:t}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var r,i,o=!0,u=!1;return{s:function(){r=e[Symbol.iterator]()},n:function(){var e=r.next();return o=e.done,e},e:function(e){u=!0,i=e},f:function(){try{o||null==r.return||r.return()}finally{if(u)throw i}}}}var A="{!MISSING!}",S=function(e){return e.replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/'/g,"&#39;").replace(/</g,"&lt;").replace(/>/g,"&gt;")};function T(e,n){var t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=t.hash,i=void 0===r?null:r,o=n?Object.create(n):{};return i&&Object.assign(o,i),o.this=e,o["@env"]=o,o["@value"]=e,o["@parent"]=n,o["@root"]=n["@root"]||o,o}function P(e,n,t,r){var i=T(e,n,{hash:r}),o=ee(e);return _(e,(function(e,n,r){return i.this=e,i["@value"]=e,i["@key"]=n,i["@index"]=r,i["@first"]=0===r,i["@last"]=r===o-1,t(e,i)}))}function x(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;if(M(e)||W(e))return 0===n?e:{value:"",safety:n};if(N(e)){if(0===n)return e;if(1===n)return{value:e,safety:n};if(2===n)return{value:e&&S(e)}}return $(e)&&J(e,"value")?0===n?e.value:{value:e.value,safety:n}:0===n?e:{value:e,safety:n}}function _(e,n){var t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";return n=ie(n),{value:ae(e,(function(e,t,r){return x.up(n(e,t,r)).value})).join(t)}}function C(e,n){throw n&&console.error(n),new Error(e)}function I(e){return e=V(e),function(n){return V(n)===e}}function R(e){return"number"==typeof e&&!isNaN(e)}function N(e){return"string"==typeof e}function L(e){return"function"==typeof e}function B(e){return null===e}function H(e){return void 0===e}function M(e){return H(e)||B(e)}function U(e){return!H(e)&&!B(e)}function D(e){return e instanceof Map}function K(e){return e instanceof Set}function W(e){return!1===e}x.NONE=2,x.WRAPPED=1,x.ESCAPED=2,x.down=function(e){return x(e,0)},x.up=function(e){return x(e,2)};var F=Array.isArray;function G(e){switch(n(e)){case"string":case"number":case"boolean":return!0;default:return!1}}function $(e){return!!e&&("object"===n(e)&&(!F(e)&&(e instanceof Object&&e.constructor===Object.prototype.constructor)))}function q(e){return Z(e)?!!ee(e):!!e}function z(e){return!q(e)}function J(e,n){return Object.prototype.hasOwnProperty.call(e,n)}function V(e){return N(e)?e.toUpperCase():e}function X(e,n,t){if(M(e)||G(e))throw new TypeError("Input object was not a collection.");if(M(n)||""===n)return!1;if(R(n))n=[String(n)];else if(N(n)){if(J(e,n))return e[n];n=n.split(/[,[\].]+?/)}var r=n.filter((function(e){return U(e)&&""!==e})).reduce((function(e,n){return U(e)?e[n]:e}),e);return H(r)||r===e?t:r}function Q(e,t){if(M(t)||""===t)return!1;R(t)?t=[String(t)]:N(t)&&(t=String.prototype.split.call(t,/[,[\].]+?/));var r,i=e,o=E(t);try{for(o.s();!(r=o.n()).done;){var u=r.value;if(M(i)||"object"!==n(i)&&L(i)||H(i[u]))return!1;i=i[u]}}catch(e){o.e(e)}finally{o.f()}return!0}function Y(e,n,t){if(M(n)||""===n)return!1;if(R(n))n=[String(n)];else if(N(n)){if(J(e,n))return e[n]=t,e;n=n.split(/[,[\].]+?/)}var r=n.length-1;return n.filter((function(e){return e||0===e})).reduce((function(e,n,i){return i===r?(e[n]=t,!0):$(e[n])||L(e[n])?e[n]:e[n]={}}),e),e}function Z(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return t&&F(e)||t&&K(e)||D(e)||e&&("object"===n(e)||"function"==typeof e)}function ee(e){return F(e)||N(e)?e.length:K(e)||D(e)?e.size:$(e)?Object.keys(e).length:!!e}function ne(e){return F(e)?e:K(e)||D(e)?Array.from(e.values()):$(e)?Object.values(e):N(e)?e.split(/,\s*/):[e]}function te(){for(var e,n=arguments.length,t=new Array(n),r=0;r<n;r++)t[r]=arguments[r];var i,o=(e=t.length>1?t:ne(t[0])).shift(),u=E(e);try{for(u.s();!(i=u.n()).done;){var a=i.value;if(!q(o))return!1;o=a}}catch(e){u.e(e)}finally{u.f()}return o}function re(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(!e)return!1;if(null===n?n=function(e){return e}:L(ie)||(n=ie(n)),F(e)){var t,r=0,i=E(e);try{for(i.s();!(t=i.n()).done;){var o=t.value;if(n(o,r,r++))return!0}}catch(e){i.e(e)}finally{i.f()}return!1}if(K(e)){var u,a=0,f=E(e);try{for(f.s();!(u=f.n()).done;){var c=u.value;if(n(c,a,a++))return!0}}catch(e){f.e(e)}finally{f.f()}return!1}if(D(e)){var l,s=0,v=E(e.entries());try{for(v.s();!(l=v.n()).done;){var h=d(l.value,2),p=h[0],y=h[1];if(n(y,p,s++))return!0}}catch(e){v.e(e)}finally{v.f()}return!1}if($(e)){for(var g=0,b=0,m=Object.entries(e);b<m.length;b++){var w=d(m[b],2),O=w[0],j=w[1];if(n(j,O,g++))return!0}return!1}return!!e}function ie(e){if(M(e))return function(e){return e};if(L(e))return e;if(N(e))return function(n){return F(n)?n.includes(e):$(n)?n[e]:D(n)?n.get(e):K(n)?n.has(e):G(n)?n[e]:n===e};if(R(e))return function(n){return $(n)||F(n)?n[e]:D(n)?n.get(e):K(n)?n.has(e):R(n)?n===e:N(n)?Number(n)===e:n===e};if(F(e)){var n=d(e,2),t=n[0],r=n[1];return function(e){return e[t]===r}}if($(e)){var i=Object.entries(e).map(ie);return function(e){var n,t=E(i);try{for(t.s();!(n=t.n()).done;){if(!(0,n.value)(e))return!1}}catch(e){t.e(e)}finally{t.f()}return!0}}}function oe(e){return function(e,n){if(!e)return{};var t=fe(n,!0);if(F(e)){var r,i=0,o=E(e);try{for(o.s();!(r=o.n()).done;){var u=r.value;if(!t(u,i,i++))break}}catch(e){o.e(e)}finally{o.f()}}else if(K(e)){var a,f=0,c=E(e);try{for(c.s();!(a=c.n()).done;){var l=a.value;if(!t(l,f,f++))break}}catch(e){c.e(e)}finally{c.f()}}else if(D(e)){var s,v=0,h=E(e.entries());try{for(h.s();!(s=h.n()).done;){var p=d(s.value,2),y=p[0],g=p[1];if(!t(g,y,v++))break}}catch(e){h.e(e)}finally{h.f()}}else if($(e))for(var b=0,m=0,w=Object.entries(e);m<w.length;m++){var O=d(w[m],2),j=O[0],k=O[1];if(!t(k,j,b++))break}return t.result()}(e,(function(e){var n=d(e,2);return[n[0],n[1]]}))}function ue(e,n,t){return N(e)||F(e)?e.slice(n,t):K(e)?new Set(Array.from(e.values()).slice(n,t)):D(e)?new Map(Array.from(e.entries()).slice(n,t)):$(e)?oe((r=e,Object.entries(r)).slice(n,t)):e;var r}function ae(e,n){return n=ie(n),F(e)?e.map((function(e,t){return n(e,t,t)})):K(e)?Array.from(e,(function(e,t){return n(e,t,t)})):D(e)?Array.from(e.entries(),(function(e,t){var r=d(e,2),i=r[0],o=r[1];return n(o,i,t)})):$(e)?Object.entries(e).map((function(e,t){var r=d(e,2),i=r[0],o=r[1];return n(o,i,t)})):N(e)?e.split().map((function(e,t){return n(e,t,t)})):[]}function fe(e){var n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];e=ie(e);var t={};function r(r,i,o){var u=e(r,i,o)||[];if(n){if(!1===u)return!1;if(!u||!F(u))return!0;var a=d(u,2),f=a[0],c=a[1];if(M(f)||H(c))return!0;t[f]=c}else t[i]=u;return!0}return r.result=function(){return t},r}function ce(e,n){if(!$(e))throw new Error("mapValues only works for simple objects, use mapReduce.");for(var t=fe(n),r=0,i=0,o=Object.entries(e);i<o.length;i++){var u=d(o[i],2),a=u[0];if(!t(u[1],a,r++))break}return t.result()}function le(e,n,t){if(!L(n))throw new TypeError("Predicate must be a function");return F(e)?e.reduce((function(e,t,r){return n(e,t,r,r)}),t):K(e)?Array.from(e).reduce((function(e,t,r){return n(e,t,r,r)}),t):D(e)?Array.from(e.entries()).reduce((function(e,t,r){var i=d(t,2),o=i[0],u=i[1];return n(e,u,o,r)}),t):$(e)?Object.entries(e).reduce((function(e,t,r){var i=d(t,2),o=i[0],u=i[1];return n(e,u,o,r)}),t):void 0}function se(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1/0;return n<=0?ue(e):le(e,(function(e,t){return e.concat.apply(e,b(Z(t)?se(t,n-1):[t]))}),[])}var ve=["WHITESPACE","TEXT","BLOCK_OPEN","BLOCK_STOP","BLOCK_START","BLOCK_CLOSE","ELSE","IDENTIFIER","LITERAL_NUM","LITERAL_STR","LITERAL_PRI","BRACKET_OPEN","BRACKET_CLOSE","PAREN_OPEN","PAREN_CLOSE","ASSIGNMENT"],he=function(e){return e>=48&&e<=57},pe=function(){for(var e=arguments.length,n=new Array(e),t=0;t<e;t++)n[t]=arguments[t];return re(n=n.flat().map(V),L)?1===(n=n.map((function(e){return L(e)&&e||I(e)}))).length?function(e){return n[0](e)}:function(e){return re(n,(function(n){return n(e)}))}:1===n.length?function(e){return V(e)===n[0]}:function(e){return n.includes(V(e))}}((function(e){return e>=65&&e<=90||e>=97&&e<=122}),he,95,64,36,46),ye=function(e){return 45===e||46===e};var de=function(){function e(){t(this,e),this._type="Node"}return i(e,[{key:"evaluate",value:function(){return null}}]),e}(),ge=function(e){f(r,e);var n=y(r);function r(){var e,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return t(this,r),(e=n.call(this)).value=i,e._type="Text",e}return i(r,[{key:"evaluate",value:function(){return{value:this.value}}}]),r}(de),be=function(e){f(r,e);var n=y(r);function r(e){var i,o=e.type,u=e.invoker,a=e.left,f=e.right,c=e.raw,l=v(e,["type","invoker","left","right","raw"]);return t(this,r),i=n.call(this),Object.assign(h(i),l),i.type=o,i.invoker=u||null,i.left=a||null,i.right=f||null,i.raw=c||!1,i._type="Block",i}return i(r,[{key:"_descender",value:function(e,n,t){return e&&e.length?function(){var r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:n,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:t;return i===t&&r!==n&&(i=T(r,i)),Ee(e,r,i)}:null}},{key:"evaluate",value:function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},t=this._descender(this.left,e,n),r=this._descender(this.right,e,n),i=this.left&&this.left.length?this.left:null,o=this.invoker?this.invoker.evaluate(e,n,{fn:t,inverse:r,children:i}):t&&t(e)||void 0;return this.raw?x(o):x.up(o)}}]),r}(de),me=function(e){f(r,e);var n=y(r);function r(){var e,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return t(this,r),e=n.call(this),Object.assign(h(e),i),e.arguments=i.arguments||[],e.hash=i.hash||{},e._type="Invocation",e}return i(r,[{key:"evaluate",value:function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=t.fn,i=t.inverse,o=t.children;if(!this.arguments.length)return"";var u=g(this.arguments),a=u[0],f=u.slice(1);a=a.evaluate(e,n);var c=this.hashCount?ce(this.hash,(function(t){return x.down(t.evaluate(e,n))})):{};if(a&&L(a.evaluate)){var l=f.length?f[0]:e,s=T(l,n,{hash:c});return o&&(s["@partial-block"]=new be({type:"@partial-block",left:o})),a.evaluate(l,s)}return L(a)?(f=f.map((function(t){return x.down(t.evaluate(e,n))})),a.apply(void 0,b(f).concat([{ctx:e,env:n,fn:r,inverse:i,arguments:f,hash:c,resolve:function(t){return Ae(t,e,n)}}]))):a&&r?r(e,n):!a&&i?i(e,n):r&&i?a?r(e,n):i(e,n):a}},{key:"set",value:function(e,n){return this.hash[e]=n,this.hashCount=(this.hashCount||0)+1,this}}]),r}(de),we=function(e){f(r,e);var n=y(r);function r(e){var i;return t(this,r),(i=n.call(this)).arguments=e||[],i._type="Collection",i}return i(r,[{key:"evaluate",value:function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.arguments.map((function(t){return t.evaluate(e,n)}))}}]),r}(me),Oe=function(e){f(r,e);var n=y(r);function r(e,i){var o;return t(this,r),(o=n.call(this)).target=e,o.critical=!!i,o._type="Identifier",o}return i(r,[{key:"evaluate",value:function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return Ae(this.target,e,n,this.critical)}}]),r}(de),je=function(e){f(r,e);var n=y(r);function r(e){var i,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],u=arguments.length>2&&void 0!==arguments[2]&&arguments[2];t(this,r),(i=n.call(this)).path=e.split(/[,[\].]+?/).filter(Boolean).map((function(e){return new Oe(e)})),i.refs=[],i.critical=u,i._type="CompoundIdentifier";var a,f=E(o);try{for(f.s();!(a=f.n()).done;){var c=a.value;c.r?i.pushRef(c.r):i.pushTarget(c)}}catch(e){f.e(e)}finally{f.f()}return i}return i(r,[{key:"evaluate",value:function(e){var n=this,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=this.refs.map((function(r){return x.down(r.evaluate(e,t,n.critical))})),i=this.path.map((function(i){return void 0!==i.ref&&(i=r[i.ref]),i.evaluate?x.down(i.evaluate(e,t,n.critical)):i})),o=i.shift();if(o){var u=X(o,i,A);return u===A?void 0:u}}},{key:"pushRef",value:function(e){this.refs.push(e),this.path.push({ref:this.refs.length-1})}},{key:"pushTarget",value:function(e){this.path.push(e)}}]),r}(de),ke=function(e){f(r,e);var n=y(r);function r(e){var i,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10;return t(this,r),(i=n.call(this)).value=e,i.type=o,i._type="Literal",i}return i(r,[{key:"evaluate",value:function(){return 8===this.type?parseFloat(this.value):this.value}}]),r}(de);function Ee(e,n,t){return Array.isArray(e)&&e.length?{value:e.map((function(e){return x.up(e.evaluate(n,t))})).filter((function(e){return""!==e.value})).map((function(e){return e.value})).join("")}:""}function Ae(e,n,t){var r,i=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(!M(n)&&!G(n)&&(r=X(n,e,A))!==A)return r;if(!M(t)&&(r=X(t,e,A))!==A)return r;for(var o=t;o=o["@parent"];){if(!M(o.this)&&!G(o.this)&&(r=X(o.this,e,A))!==A)return r;if(!M(o)&&(r=X(o,e,A))!==A)return r}i&&C('Could not resolve "'.concat(e,'"'))}function Se(e,n){var t,r,i=function(e){var n=e.length-1,t=!1,r=0,i=1,o=1,u=[],a=-1;function f(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:i,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:o,a={type:e,contents:n,line:t,column:r};return u.push(a),a}var c=new SyntaxError;function l(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},t=n.l,r=void 0===t?i:t,a=n.c,f=void 0===a?o:a,l=v(n,["l","c"]);throw c.message=e+" (".concat(r,":").concat(f,")"),console.dir(u),Object.assign(c,l,{line:r,column:f})}function s(){return{p:r,l:i,c:o}}function h(n){return e.startsWith(n,r)}function p(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,i=r+t;if(!(i>n||i<0))return e.charCodeAt(i)}function y(n){13===n||10===n?(i++,o=1,13===n&&10===e.charCodeAt(r)&&r++):o++}function d(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,i=Math.min(n+1,Math.max(0,r+t));if(t>0)for(var o=r;o<i;o++)y(e.charCodeAt(o));return(r=i)<=n}function g(){return r>n}function b(){if(g())return!1;var n,t=E(b.order);try{for(t.s();!(n=t.n()).done;){if((0,n.value)())return!0}}catch(e){t.e(e)}finally{t.f()}l("Unknown token: ".concat(e.substr(r,20),"…"))}return b.order=[function(){if(!t&&123===p(0)&&123===p(1)){t=!0;var e=f(4,"{{");return 123===p(2)?(e.raw=!0,e.contents="{{{",d(3)):d(2),35===p()?(f(2,"#"),d(1)):47===p()?(f(5,"/"),d(1)):(h("else")||h("ELSE"))&&(f(6,"else"),d(4)),!0}},function(){if(!t){var n=p(),i=s(),o=i.p,u=i.l,a=i.c;do{if(123===n&&123===p(1))break;d()}while(n=p());if(o!==r)return f(1,e.slice(o,r),u,a),!0}},function(){if(t){for(var i,o=s(),u=o.p,a=o.l,c=o.c;r<=n&&(i=p(0))&&!(i>14&&32!==i&&160!==i);)d();if(u!==r)return f(0,e.slice(u,r),a,c),!0}},function(){var n=p();if(t&&!he(n)&&pe(n)&&46!==n){var i=s(),o=i.p,u=i.l,a=i.c;for(d();(n=p())&&pe(n);)d();if(o!==r){var c=e.slice(o,r);return"true"===c?f(10,!0,u,a):"false"===c?f(10,!1,u,a):"null"===c?f(10,null,u,a):f(7,c,u,a),!0}}},function(){if(t){var n=p();if((he(n)||ye(n))&&(!ye(n)||he(p(1)))){var i=s(),o=i.p,u=i.l,a=i.c,c=!1;do{if(45!==n){if(46===n){if(c)break;c=!0}else if(!he(n))break;d()}else{if(r!==o)break;d()}}while(n=p());if(o!==r)return f(8,e.slice(o,r),u,a),!0}}},function(){var n=p();if(t&&function(e){return 39===e||34===e}(n)){var i=s(),o=i.p,u=i.l,a=i.c,c=n;for(d();n=p();)if(92!==n){if(n===c)return f(9,r-o==1?"":e.slice(o+1,r).replace(/\\(.)/,"$1"),u,a),d(),!0;d()}else d(2);l("Unterminated string literal: ".concat(e.substr(o,20),"…"),{l:u,c:a})}},function(){if(t&&61===p())return f(15,"="),d(),!0},function(){if(t&&91===p())return f(11,"["),d(),!0},function(){if(t&&93===p())return f(12,"]"),d(),46===p()&&d(),!0},function(){if(t&&40===p())return f(13,"("),d(),!0},function(){if(t&&41===p())return f(14,")"),d(),46===p()&&d(),!0},function(){if(t&&125===p(0)&&125===p(1)){t=!1;var e=f(3,"}}");return 125===p(2)?(e.raw=!0,e.contents="}}}",d(3)):d(2),!0}}],{get eof(){return g()},get current(){for(;a>=u.length&&!g();)b();return u[a]},readAll:function(){for(;b(););return u},reset:function(){return a=-1,this},next:function(){for(a++;a>=u.length&&!g();)b();return u[a]},peek:function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,n=a+e;n>=u.length&&!g();)b();return u[n]}}}(e),o=0;function u(e,n){if(!i.eof){var u=i.peek();if(H(e)||!u||u.type===e)return r=u.contents,o++,t=i.next();n&&c(N(n)?n:"Expected ".concat(e," but found ").concat(ve[u.type]),u)}}function a(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,t=i.peek(n);if(H(e)||!t||t.type===e)return t}var f=new SyntaxError;function c(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"Unexpected token: "+ve[t.type],r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:t||{},i=r.line,u=r.column,a=v(r,["line","column"]);e+=i?" (".concat(i,":").concat(u,")"):"",n&&(e+="[Token ".concat(o,"]"));var c=f;throw n?c=new SyntaxError(e):f.message=e,Object.assign(c,a)}var l=function(e){return function(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:t;return n&&n.type===e}},s=l(7),h=l(1),p=l(0),y=l(4),d=l(3),g=l(11),b=l(12),m=l(13),w=l(14),O=l(15),j=l(8),k=l(9),A=l(10),S=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:t;return j(e)||k(e)||A(e)};function T(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],n=new me,i=n.arguments,o=!1;do{if(i.length&&e&&(i[0].critical=!0),!p())if(s())a(11)?o?(n.set(o,P(r)),o=!1):i.push(P(r)):o?(n.set(o,new Oe(r)),o=!1):i.push(new Oe(r));else{if(d())return i.length>1&&(i[0].critical=!0),n;if(i.length||c('Block helpers must start with a variable identifier, found "'.concat(t.contents,'" (').concat(ve[t.type],")")),m())u(),o?(n.set(o,T(!0)),o=!1):i.push(T(!0));else if(S())o?(n.set(o,new ke(r,t.type)),o=!1):i.push(new ke(r,t.type));else if(g())o?(n.set(o,x()),o=!1):i.push(x());else{if(o&&c(),w())return e||c(),n;if(O()){var f=i.pop();o=f.target}else c()}}}while(u());return e&&c("Unexpected end of token stream, unclosed nested invocation."),n}function P(e){for(var n=new je(e),i=!1;u()&&!p();){if(b()){var o=a();if(g(o)||s(o))continue;break}if(s()){u(11)&&n.pushRef(P(r)),i?(i=!1,n.pushRef(new Oe(r))):n.pushTarget(r);var f=a();if(g(f)||b(f))continue;break}if(m())n.pushRef(T(!0));else if(S())n.pushTarget(new ke(r,t.type));else{if(!g())break;i=!0}}return n}function x(){for(var e=new we,n=e.arguments;u();)if(!p()){if(b())return e;m()?n.push(T(!0)):s()?u(11)?n.push(P(r)):n.push(new Oe(r)):S()?n.push(new ke(r,t.type)):g()?n.push(x()):c()}c("Unexpected end of token stream, unclosed collection.")}var _=function e(n){var i=!1;t?s()||c('Block helpers must start with a variable identifier, found "'.concat(t.contents,'" (').concat(ve[t.type],")")):i=!0;var o=new be({type:i?"ROOT":r,invoker:i?null:T(),left:[]});n&&(o.raw=n);for(var f=o.left;u();)if(h())f.push(new ge(r));else if(y()){var l=t.raw;if(u(2))u(),f.push(e(l));else if(u(6)){for(f.length||f.push(new ge),f=o.right=[];u(0););u(3,'Expected }}, found "'.concat(t.contents,'" (').concat(ve[t.type],")"))}else{if(u(5)){for(u(7,'The first argument of a block must be an identifier, found "'.concat(t.contents,'" (').concat(ve[t.type],")")),r!==o.type&&c("Expected {{/".concat(o.type,"}} but found {{/").concat(r,"}}")),f.length||f.push(new ge);u(0););return u(3,'Expected }}, found "'.concat(t.contents,'" (').concat(ve[t.type],")")),o}u(7)?f.push(new be({type:r,invoker:T(),raw:l})):c("This shouldn't have happened. \"".concat(a().contents,'" (').concat(ve[a().type],")"))}}else c("Unexpected token while processing block children for {{#".concat(o.type,'}}: "').concat(t.contents,'" (').concat(ve[t.type],")"));return i||c("Unexpected end of template, unclosed {{#".concat(o.type,"}}")),o}();return i.eof||c("There are still tokens left, how did we get here?"),_}function Te(){for(var e=arguments.length,n=new Array(e),t=0;t<e;t++)n[t]=arguments[t];if(n.length<3)throw new Error('Helper "get" needs a minimum of 3 arguments');var r=n.pop(),i=r.fn,o=r.inverse,u=n.shift();if(!u)return"";var a=X(u,n=1===n.length?n[0]:se(n),A);return a===A?o?o():"":i?i(a):a}function Pe(){for(var e=arguments.length,n=new Array(e),t=0;t<e;t++)n[t]=arguments[t];var r=n.pop(),i=r.ctx,o=r.fn,u=r.inverse,a=n.shift(),f=n.length?a!==n[0]:z(a);return o?f?o(i):u&&u():f||""}var xe={if:function(){for(var e=arguments.length,n=new Array(e),t=0;t<e;t++)n[t]=arguments[t];if(n.length<1)throw new Error('Helper "if" needs a minimum of 1 arguments');var r=n.pop(),i=r.ctx,o=r.fn,u=r.inverse,a=n.shift(),f=n.length?a===n[0]:q(a);return o?f?o(i):u&&u():f||""},with:function(){for(var e=arguments.length,n=new Array(e),t=0;t<e;t++)n[t]=arguments[t];var r=n.pop(),i=r.env,o=r.fn,u=r.inverse,a=r.hash;if(!o&&!u)return"";if(!n.length)return"";var f=n[0],c=T(f,i,{hash:a});return q(f)?o(f,c):u&&u()},each:function(e){for(var n=arguments.length,t=new Array(n>1?n-1:0),r=1;r<n;r++)t[r-1]=arguments[r];var i=t.pop(),o=i.env,u=i.fn,a=i.inverse,f=i.hash,c=ee(e);return c?u?P(e,o,u,f):e:a?a():e},log:function(){for(var e,n=arguments.length,t=new Array(n),r=0;r<n;r++)t[r]=arguments[r];var i=t.pop(),o=i.env;t.length||(t=[o]),(e=console).log.apply(e,b(t))},not:Pe,unless:Pe,has:function(){for(var e=arguments.length,n=new Array(e),t=0;t<e;t++)n[t]=arguments[t];if(n.length<3)throw new Error('Helper "has" needs a minimum of 3 arguments');var r=n.pop(),i=r.fn,o=r.inverse,u=n.shift(),a=Q(u,n=1===n.length?n[0]:se(n));return i?a?i():o&&o():a||""},is:function(){for(var e=arguments.length,n=new Array(e),t=0;t<e;t++)n[t]=arguments[t];if(n.length<3)throw new Error('Helper "is" needs a minimum of 2 arguments');var r=n.pop(),i=r.fn,o=r.inverse,u=n.shift(),a=n.includes(u);return i?a?i(this):o&&o(this):a||""},isNot:function(){for(var e=arguments.length,n=new Array(e),t=0;t<e;t++)n[t]=arguments[t];if(n.length<3)throw new Error('Helper "isNot" needs a minimum of 2 arguments');var r=n.pop(),i=r.fn,o=r.inverse,u=n.shift(),a=-1===n.indexOf(u);return i?a?i():o&&o():a||""},all:function(){for(var e=arguments.length,n=new Array(e),t=0;t<e;t++)n[t]=arguments[t];var r=n.pop(),i=r.fn,o=r.inverse;if(!n.length)throw new Error('Helper "all" needs 1 parameter');var u=te.apply(void 0,n);return i?u?i(u):o&&o(this):u||""},any:function(){for(var e=arguments.length,n=new Array(e),t=0;t<e;t++)n[t]=arguments[t];var r=n.pop(),i=r.fn,o=r.inverse;if(!n.length)throw new Error('Helper "any" needs 1 parameter');var u,a=!1,f=E(n.length>1?n:ne(n[0]));try{for(f.s();!(u=f.n()).done;){var c=u.value;if(q(c)){a=c;break}}}catch(e){f.e(e)}finally{f.f()}return i?a?i(a):o&&o():a||""},get:Te,lookup:Te};function _e(e){return N(e)?Se(e):e instanceof be?e:void C("Parse can only receive strings or a Handybars AST tree")}function Ce(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},t=_e(e),r=a({},xe,{},n);function i(e){var n=T(e,r);return t.evaluate(e,n).value}return i.set=function(){for(var e=arguments.length,n=new Array(e),t=0;t<e;t++)n[t]=arguments[t];return $(n[0])?Object.assign.apply(Object,[r].concat(n)):Y.apply(void 0,[r].concat(n)),i},i.setPartial=function(e,n){return Y(r,e,Se(n))},i}Object.assign(Ce,{partial:_e,parse:_e,evaluate:function(e,n){return N(e)?e=Se(e):e instanceof be||C("Evaluate can only receive strings or a Handybars AST tree"),e.evaluate(n,xe).value},Text:ge,Block:be,Invocation:me,Collection:we,Identifier:Oe,Literal:ke,makeContext:T,safe:x,safeJoin:_}),e.default=Ce,Object.defineProperty(e,"__esModule",{value:!0})}));